<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: A flexible, scalable bar chart</title>
		<script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
		<style type="text/css">
			body {
    		background-color: rgb(255, 204, 102);
			}
			p { 
			font-family: "Arial";
			text-align: "center";
			}
			#options { cursor: pointer; }
			#text {position: absolute; left: 300px; right: 300px; z-index: 200;}
			#options { position: absolute; visibility: visible; left: 950px; top: 320px; z-index: 220; } 
			#graphics { position: relative; visibility: visible; left: 280px; right: 300px;top: 275px; z-index: 200; } 
			#lasttext {position: absolute; left: 300px; right: 300px; bottom: 10px; z-index: 200;}

			.x.axis path,
			.x.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.x.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
			.y.axis path,
			.y.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.y.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
		</style>
	</head>
	<body>
		<div id = "text">
		<h3><c><i>This is a reproduction of 
			<a href="http://iquantny.tumblr.com/post/129373499164/this-is-quantifiably-the-best-month-to-go-to-the">
				http://iquantny.tumblr.com/post/129373499164/this-is-quantifiably-the-best-month-to-go-to-the
			</a>
			</i></c></h3>
	
		
	<p><p>As part of a homework assignment, I ask my students at Pratt to go out and chart something of interest to them, and 
		<a >Katherine Savarese</a>
		came back with a simple chart about farmers markets that I loved- it inspired this post.</p>
		<p>You probably know that farmers markets are a staple across 
			<a >all five boroughs</a> of New York City, but September happens to be a very special month.  Why is that? &nbsp;Well, 
			it turns out September is the month with the most unique types of fresh produce- forty three to be exact.</p>
		<p>To show the current offerings, we charted how many types of fruits and vegetables are available by month, and showed if they were fresh or from storage.&nbsp;	
		</div>
		
	<div id = "options">
		<p id="ff"><b>Fresh fruit</b></p>
		<p id="sf"><b>Storage fruit</b></p>
		<p id="fv"><b>Fresh vegetable</b></p>
		<p id="sv"><b>Storage vegetable</b></p>
	</div>
		
	<div id = "graphics">
	</div>
		
	<div id = "lasttext">
	<p>If you miss the month of September, you might be behind the fruit curve, but there are plenty more months of vegetables left.  The chart shows that fresh vegetables are available 9 out of 12 months, but fruit is only available 5 out of 12. Now if only we could quantify how delicious the produce is… 
	</p>
	</div>
		
			<script type="text/javascript">
			
			//Width and height
			var w = 600;
			var h = 300;
			var botPadding = 40;
			//var topPadding = 40;
			var sidePadding = 45;
			
			//var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
			//				11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];
			
			var dataset = [['Jan',0], ['Feb',0], ['Mar',0],
						  ['Apr',0],['May',0],['Jun',1],
						  ['Jul',7],['Aug',8],['Sep',10],
						  ['Oct',5],['Nov',0],['Dec',0],]; // just testing it out for now
			var dataset2 = [['Jan',2], ['Feb',2], ['Mar',1],
						  ['Apr',1],['May',1],['Jun',1],
						  ['Jul',0],['Aug',0],['Sep',0],
						  ['Oct',0],['Nov',2],['Dec',2]];
			var dataset3 = [['Jan',0], ['Feb',0], ['Mar',0],
						  ['Apr',2],['May',11],['Jun',16],
						  ['Jul',23],['Aug',28],['Sep',33],
						  ['Oct',31],['Nov',11],['Dec',3],];
			
			var dataset4 = [['Jan',9], ['Feb',9], ['Mar',6],
						  ['Apr',3],['May',3],['Jun',3],
						  ['Jul',2],['Aug',1],['Sep',0],
						  ['Oct',0],['Nov',6],['Dec',8],];
			
			
			
			
			var months = [];
			for (var i = 0; i < dataset.length; i++){
				months.push(dataset[i][0]);
			}
			var xScale = d3.scaleBand()
							.domain(months)
							.rangeRound([sidePadding, w-sidePadding])
							.paddingInner(0.25);
			
			var yScale = d3.scaleLinear()
							.domain([0, d3.max(dataset, function(d){
								return d[1]; //numeric value here
							})])
							.range([botPadding, h-botPadding]);
			
			//Create SVG element
			var svg = d3.select("#graphics")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			//Create bars
			svg.selectAll("rect")
			   .data(dataset)
			   .enter()
			   .append("rect")
			   .attr("opacity",1)
			   .attr("x", function(d) {
			   		return xScale(d[0]); // months from Jan to Dec will be scaled to positions in x axis
			   })
			   .attr("y", function(d) {
			   		return h - yScale(d[1]); //OBS
			   })
			   .attr("width", xScale.bandwidth())
			   .attr("height", function(d) {
			   		return yScale(d[1]) - botPadding;
			   })
			   .attr("fill", function(d) {
					return "rgb(222,0,0)";
			   });
			
			//X axis
			var xAxis = d3.axisBottom();
			xAxis.scale(xScale);
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0, " + (h - botPadding) + ")")
				.call(xAxis);
			//Y axis
			var yAxis = d3.axisLeft();
			
			//change scale here to reverse yAxis (maybe there is a better way to do this!)
			yAxis.scale(yScale.range([h-botPadding, botPadding]));
			yAxis.tickFormat(d3.format("d")); // only integer ticks
			//yAxis.ticks(5);
			svg.append("g")
				.attr("class", "y axis")
				.attr("transform", "translate(" + (sidePadding) + ",0)")
				.call(yAxis);
			
			//Label of the Y axis
			svg.append("text")
			   .attr("transform", "rotate(-90)")
			   .attr("y", sidePadding-40)
      		   .attr("x",-135)
      		   .attr("dy", "1em")
			   .style("font-size", "14px")
			   .style("text-anchor", "middle")
			   .style("font-weight", "bold")
			   .text("# of Unique Kinds of Produce");
			//Title of the plot
			svg.append("text")
				.attr("y",botPadding/2)
				.attr("x", w/2)
				.style("font-size", "15px")
			    .style("text-anchor", "middle")
				.style("font-weight", "bold")
				.text("NYC Green Markets - Unique Produce Types");
			
			var changeData = function(newDataset, newColor){
				// update scale to accommodate larger values
				yScale.domain([0, d3.max(newDataset, function(d){
								return d[1]; //numeric value here
							})]);
				// update axis as well
				
				svg.selectAll("g.y.axis").transition().duration(500).call(yAxis.scale(yScale.range([h-botPadding, botPadding])));
				// return range to normal for bars
				yScale.range([botPadding, h-botPadding]);

				// rebind data
				svg.selectAll("rect")
			   .data(newDataset)
			   .transition() // make a beautiful transition between different datasets
			   /*.delay(function(d,i){
				return i /dataset.length * 1500; // add a delay different for each bar (based on id), last element 1.5 sec
			   })*/
			   .duration(500)
			   .ease(d3.easeCubicInOut) // different transition animation types
			   .attr("y", function(d){
				return h - yScale(d[1]);
				})
			   .attr("height", function(d){
					console.log("setting size: " + yScale(d[1]));
				return yScale(d[1]) - botPadding;
				})
				.attr("fill", function(d){
					if(newColor==="red" || newColor==="lightred"){
						return "rgb(222,0,0)";
					}
					else if(newColor==="green" || newColor==="lightgreen"){
						return "rgb(0,222,0)";
					}
				})
				.attr("opacity", function(d){
					if(newColor==="red" || newColor==="green"){
							return 1;
						}
					else {
						return 0.7;
					}
				});
			
			}
		
			
			// Beautifully change to another dataset
			d3.select("#ff")
			.on("click", function(){
				d3.select("g.y.axis").transition().duration(500).call(yAxis.ticks()); // reset axis to use default amount of ticks
				changeData(dataset, "red");
			});
			
			d3.select("#fv")
			.on("click", function(){
				d3.select("g.y.axis").transition().duration(500).call(yAxis.ticks(2));// for fresh veggies default amount behaves weird, so have to force 2 ticks (not an optimal solution...)
				changeData(dataset2, "green");
			});
			d3.select("#sf")
			.on("click", function(){
				d3.select("g.y.axis").transition().duration(500).call(yAxis.ticks());
				changeData(dataset3, "lightred");
			});
			
			d3.select("#sv")
			.on("click", function(){
				d3.select("g.y.axis").transition().duration(500).call(yAxis.ticks());
				changeData(dataset4, "lightgreen");
			});
				/*
				svg.selectAll("text")
				.data(dataset2)
				.transition()
				
				.delay(function(d,i){
					return i / dataset.length * 1500;
				})*/
				/*
				.duration(500)
				.ease(d3.easeCubicInOut)
				.text(function(d) {
			   		return d;
				})
				.attr("x", function(d, i){
				return xScale(i) + xScale.bandwidth() / 2; // locating text in the middle of bars once again
				})
				.attr("y", function(d, i){
				 if(d<10){
					 console.log("changing " + i + " to black");
					 d3.select("#num"+i)
					.attr("fill","black"); 
				 	return h - yScale(d) - 22;
				 }
				 else{
					 d3.select("#num"+i)
					 .attr("fill","white");
					 return h - yScale(d) + 2; // locating labels on the top of the bars
				 }
				});		*/
		

		</script>
		
	</body>
</html>